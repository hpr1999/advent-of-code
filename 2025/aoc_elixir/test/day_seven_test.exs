defmodule DaySevenTest do
  use ExUnit.Case
  doctest DaySeven
  import DaySeven

  test "parse" do
  end

  test "p1 demo sim" do
    result =
      """
      .......S.......
      ...............
      .......^.......
      ...............
      ......^.^......
      ...............
      .....^.^.^.....
      ...............
      ....^.^...^....
      ...............
      ...^.^...^.^...
      ...............
      ..^...^.....^..
      ...............
      .^.^.^.^.^...^.
      ...............
      """
      |> String.split()
      |> parse()
      |> simulate_beam()

    assert result ===
             """
             .......S.......
             .......|.......
             ......|^|......
             ......|.|......
             .....|^|^|.....
             .....|.|.|.....
             ....|^|^|^|....
             ....|.|.|.|....
             ...|^|^|||^|...
             ...|.|.|||.|...
             ..|^|^|||^|^|..
             ..|.|.|||.|.|..
             .|^|||^||.||^|.
             .|.|||.||.||.|.
             |^|^|^|^|^|||^|
             |.|.|.|.|.|||.|
             """
             |> String.split()
             |> parse()
  end

  test "p1 demo count" do
    flow =
      """
      .......S.......
      .......|.......
      ......|^|......
      ......|.|......
      .....|^|^|.....
      .....|.|.|.....
      ....|^|^|^|....
      ....|.|.|.|....
      ...|^|^|||^|...
      ...|.|.|||.|...
      ..|^|^|||^|^|..
      ..|.|.|||.|.|..
      .|^|||^||.||^|.
      .|.|||.||.||.|.
      |^|^|^|^|^|||^|
      |.|.|.|.|.|||.|
      """

    assert flow |> String.split() |> parse() |> count_splits() === 21
  end

  test "p1 solve" do
    assert part1(parse()) === 1546
  end

  test "p2 demo" do
    input =
      """
      .......S.......
      ...............
      .......^.......
      ...............
      ......^.^......
      ...............
      .....^.^.^.....
      ...............
      ....^.^...^....
      ...............
      ...^.^...^.^...
      ...............
      ..^...^.....^..
      ...............
      .^.^.^.^.^...^.
      ...............
      """

    assert input |> String.split() |> parse() |> part2() === 40
  end

  test "p2 solve" do
    assert part2(parse()) === 13_883_459_503_480
  end
end
